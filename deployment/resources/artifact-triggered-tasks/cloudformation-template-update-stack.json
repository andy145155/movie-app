{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "The AWS CloudFormation template for this Serverless application",
  "Resources": {
    "TriggerFargateLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/movie-app-triggered-tasks-dev-triggerFargate"
      }
    },
    "CsvToS3DatabaseLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/movie-app-triggered-tasks-dev-csvToS3Database"
      }
    },
    "MovieAppTriggeredTaskLambdaLayer": {
      "Type": "AWS::Lambda::LayerVersion",
      "Properties": {
        "Content": {
          "S3Bucket": "movie-app-serverless-bucket",
          "S3Key": "serverless/movie-app-triggered-tasks/dev/1718985282060-2024-06-21T15:54:42.060Z/MovieAppTriggeredTask.zip"
        },
        "LayerName": "movie-app-triggered-tasks-layer",
        "CompatibleRuntimes": [
          "python3.11"
        ]
      }
    },
    "TriggerFargateLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "movie-app-serverless-bucket",
          "S3Key": "serverless/movie-app-triggered-tasks/dev/1718985282060-2024-06-21T15:54:42.060Z/movie-app-triggered-tasks.zip"
        },
        "Handler": "functions/triggerFargate.handler",
        "Runtime": "python3.11",
        "FunctionName": "movie-app-triggered-tasks-dev-triggerFargate",
        "MemorySize": 1024,
        "Timeout": 300,
        "Architectures": [
          "arm64"
        ],
        "Environment": {
          "Variables": {
            "SUBNET_A_ID": "subnet-069ee4c1a5955765d",
            "SUBNET_B_ID": "subnet-0ce7bc386fe60d549",
            "FARGATE_SG_ID": "sg-01156858c7871ec6c",
            "MOVIE_APP_ESC_CLUSTER_ARN": "arn:aws:ecs:ap-southeast-1:410370150231:cluster/movie-app-fargate-dev-FargateTasksCluster-sLoYFCjpH417",
            "MOVIES_SIMILARITY_DYNAMO_DB_NAME": "movie-similarity",
            "DATA_PROCESSING_TASK_DEFINITION_ARN": "arn:aws:ecs:ap-southeast-1:410370150231:task-definition/dataProcessing",
            "MOVE_CSV_PROCESSED_BUCKET_NAME": "movie-app-csv-processed-bucket",
            "MOVE_CSV_SOURCE_BUCKET_NAME": "movie-app-csv-source-bucket"
          }
        },
        "Role": "arn:aws:iam::410370150231:role/movie-app-LambdaExecuteRole",
        "Layers": [
          {
            "Ref": "MovieAppTriggeredTaskLambdaLayer"
          }
        ]
      },
      "DependsOn": [
        "TriggerFargateLogGroup"
      ]
    },
    "CsvToS3DatabaseLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "movie-app-serverless-bucket",
          "S3Key": "serverless/movie-app-triggered-tasks/dev/1718985282060-2024-06-21T15:54:42.060Z/movie-app-triggered-tasks.zip"
        },
        "Handler": "functions/csvToS3Database.handler",
        "Runtime": "python3.11",
        "FunctionName": "movie-app-triggered-tasks-dev-csvToS3Database",
        "MemorySize": 1024,
        "Timeout": 300,
        "Architectures": [
          "arm64"
        ],
        "Environment": {
          "Variables": {
            "MOVE_CSV_PROCESSED_BUCKET_NAME": "movie-app-csv-processed-bucket"
          }
        },
        "Role": "arn:aws:iam::410370150231:role/movie-app-LambdaExecuteRole",
        "Layers": [
          {
            "Ref": "MovieAppTriggeredTaskLambdaLayer"
          }
        ]
      },
      "DependsOn": [
        "CsvToS3DatabaseLogGroup"
      ]
    },
    "TriggerFargateLambdaVersionLXXjVtIIZysJJT8hnUNCGJgO8JGn9b4eU48SqBo90": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "TriggerFargateLambdaFunction"
        },
        "CodeSha256": "0ejNfJ4MqbiTtA8s0ufAuHLtr6r4Y84Q2yBfip9iLuc="
      }
    },
    "CsvToS3DatabaseLambdaVersionpQL1IU5b5iROGLJpjkKmw17SC8yQ7X7Aw3LNjwoNPfY": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "CsvToS3DatabaseLambdaFunction"
        },
        "CodeSha256": "0ejNfJ4MqbiTtA8s0ufAuHLtr6r4Y84Q2yBfip9iLuc="
      }
    },
    "TriggerFargateSnsSubscriptionMovieapps3triggeredevent": {
      "Type": "AWS::SNS::Subscription",
      "Properties": {
        "TopicArn": "arn:aws:sns:ap-southeast-1:410370150231:movie-app-s3-triggered-event",
        "Protocol": "lambda",
        "Endpoint": {
          "Fn::GetAtt": [
            "TriggerFargateLambdaFunction",
            "Arn"
          ]
        }
      }
    },
    "TriggerFargateLambdaPermissionMovieapps3triggeredeventSNS": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Fn::GetAtt": [
            "TriggerFargateLambdaFunction",
            "Arn"
          ]
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "sns.amazonaws.com",
        "SourceArn": "arn:aws:sns:ap-southeast-1:410370150231:movie-app-s3-triggered-event"
      }
    },
    "CsvToS3DatabaseSnsSubscriptionMovieapps3triggeredevent": {
      "Type": "AWS::SNS::Subscription",
      "Properties": {
        "TopicArn": "arn:aws:sns:ap-southeast-1:410370150231:movie-app-s3-triggered-event",
        "Protocol": "lambda",
        "Endpoint": {
          "Fn::GetAtt": [
            "CsvToS3DatabaseLambdaFunction",
            "Arn"
          ]
        }
      }
    },
    "CsvToS3DatabaseLambdaPermissionMovieapps3triggeredeventSNS": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Fn::GetAtt": [
            "CsvToS3DatabaseLambdaFunction",
            "Arn"
          ]
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "sns.amazonaws.com",
        "SourceArn": "arn:aws:sns:ap-southeast-1:410370150231:movie-app-s3-triggered-event"
      }
    }
  },
  "Outputs": {
    "ServerlessDeploymentBucketName": {
      "Value": "movie-app-serverless-bucket",
      "Export": {
        "Name": "sls-movie-app-triggered-tasks-dev-ServerlessDeploymentBucketName"
      }
    },
    "MovieAppTriggeredTaskLambdaLayerQualifiedArn": {
      "Description": "Current Lambda layer version",
      "Value": {
        "Ref": "MovieAppTriggeredTaskLambdaLayer"
      },
      "Export": {
        "Name": "sls-movie-app-triggered-tasks-dev-MovieAppTriggeredTaskLambdaLayerQualifiedArn"
      }
    },
    "MovieAppTriggeredTaskLambdaLayerHash": {
      "Description": "Current Lambda layer hash",
      "Value": "758aea6f647e179a088cbed8df3500c702ae3c90",
      "Export": {
        "Name": "sls-movie-app-triggered-tasks-dev-MovieAppTriggeredTaskLambdaLayerHash"
      }
    },
    "MovieAppTriggeredTaskLambdaLayerS3Key": {
      "Description": "Current Lambda layer S3Key",
      "Value": "serverless/movie-app-triggered-tasks/dev/1718985282060-2024-06-21T15:54:42.060Z/MovieAppTriggeredTask.zip",
      "Export": {
        "Name": "sls-movie-app-triggered-tasks-dev-MovieAppTriggeredTaskLambdaLayerS3Key"
      }
    },
    "TriggerFargateLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "TriggerFargateLambdaVersionLXXjVtIIZysJJT8hnUNCGJgO8JGn9b4eU48SqBo90"
      },
      "Export": {
        "Name": "sls-movie-app-triggered-tasks-dev-TriggerFargateLambdaFunctionQualifiedArn"
      }
    },
    "CsvToS3DatabaseLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "CsvToS3DatabaseLambdaVersionpQL1IU5b5iROGLJpjkKmw17SC8yQ7X7Aw3LNjwoNPfY"
      },
      "Export": {
        "Name": "sls-movie-app-triggered-tasks-dev-CsvToS3DatabaseLambdaFunctionQualifiedArn"
      }
    }
  }
}